params$NonConvex = 2
params$ResultFile = 'model.sol'
I = length(u)
w = as.list(rep(NA,I))
for(i in 1:I){
model = model_real(G,R,e,n,gamma,k,u[i])
result <- gurobi(model, params)
w[[i]] = result$x[1:(n+1)]
}
return(w)
}
w_real_chi_u = opt_real_u(G,R,0.0006,n,gamma,k,u)
u = c(1,0.2,0.3,0.4,0.5,0.6) #unpper bound for weights
w_real_chi_u = opt_real_u(G,R,0.0006,n,gamma,k,u)
e = c(0.0004,0.0005,0.0006,0.0007)
w_real_chi_e = opt_real_e(G,R,e,n,gamma,k,1)
k = 0.001 #unit sell&buy transaction cost
w_real_chi_u = opt_real_u(G,R,0.0006,n,gamma,k,u)
w = w_real_chi_u
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table8.csv", row.names = FALSE)
k = 0.001 #unit sell&buy transaction cost
e = c(0.0004,0.0005,0.0006,0.0007)
w_real_chi_e = opt_real_e(G,R,e,n,gamma,k,1)
w = w_real_chi_e
K = length(w)
result_fg3=c()
for(k in 1:K){
result_fg3 = cbind(result_fg3,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result_fg3,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg3.csv", row.names = FALSE)
result_fg3
k = 0.001 #unit sell&buy transaction cost
e = c(0.0004,0.0005,0.0006,0.0007)
w_real_chi_e = opt_real_e(G,R,e,n,gamma,k,0.2)
w = w_real_chi_e
K = length(w)
result_fg3_MG=c()
for(k in 1:K){
result_fg3_MG = cbind(result_fg3_MG,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result_fg3,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg3_MG.csv", row.names = FALSE)
result_fg3_MG
opt_real_k = function(G,R,e,n,gamma,k,u){
## set model parameters
params <- list()
params$method = 2
params$NonConvex = 2
params$ResultFile = 'model.sol'
I = length(k)
w = as.list(rep(NA,I))
for(i in 1:I){
model = model_real(G,R,e,n,gamma,k[i],u)
result <- gurobi(model, params)
w[[i]] = result$x[1:(n+1)]
}
return(w)
}
k = c(0.0008,0.0009,0.001,0.0011)
w_real_chi_k = opt_real_k(G,R,0.0006,n,gamma,k,0.2)
w = w_real_chi_k
K = length(w)
result_fg4_MG=c()
for(k in 1:K){
result_fg4_MG = cbind(result_fg4_MG,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result_fg4,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg4_MG.csv", row.names = FALSE)
result_fg4_MG
opt_real_MV_e = function(G,R,e,n,gamma,k,u){
## set model parameters
params <- list()
params$method = 2
params$NonConvex = 2
params$ResultFile = 'model.sol'
I = length(e)
w = as.list(rep(NA,I))
for(i in 1:I){
model = model_real_MV(G,R,e[i],n,gamma,k,u)
result <- gurobi(model, params)
w[[i]] = result$x[1:(n+1)]
}
return(w)
}
opt_real_MV_u = function(G,R,e,n,gamma,k,u){
## set model parameters
params <- list()
params$method = 2
params$NonConvex = 2
params$ResultFile = 'model.sol'
I = length(u)
w = as.list(rep(NA,I))
for(i in 1:I){
model = model_real(G,R,e,n,gamma,k,u[i])
result <- gurobi(model, params)
w[[i]] = result$x[1:(n+1)]
}
return(w)
}
opt_real_MV_k = function(G,R,e,n,gamma,k,u){
## set model parameters
params <- list()
params$method = 2
params$NonConvex = 2
params$ResultFile = 'model.sol'
I = length(k)
w = as.list(rep(NA,I))
for(i in 1:I){
model = model_real(G,R,e,n,gamma,k[i],u)
result <- gurobi(model, params)
w[[i]] = result$x[1:(n+1)]
}
return(w)
}
## realistic model
model_real_MV = function(Sigma,R,e,n,gamma,k,u){
model$Q = rbind(cbind(Sigma,matrix(rep(0,n*(n+1)),nrow=n+1,ncol=n)),
matrix(rep(0,n*(2*n+1)),nrow=n,ncol=2*n+1))
cons_c = cbind(diag(-k,n),rep(0,n),diag(1,n))
model$A = rbind(c(rep(1,n+1),rep(0,n)),c(R,rep(-1,n)),
c(rep(0,n+1),rep(1,n)),cons_c)
model$rhs = c(1,e,gamma,rep(0,n))
model$sense= c('=','=','<=',rep('>=',n))
model$ub = c(rep(u,n+1),rep(gamma,n))
return(model)
}
e = c(0.0007,0.0008,0.0009,0.001) #vector of required return
k = 0.001 #unit sell&buy transaction cost
gamma = 0.005 #bond for total transaction cost
u = 0.2 #unpper bound for weights
n = Chi$n
Sigma = Chi$Sigma
r = Chi$r_bar
R = Chi$R_bar
e = c(0.0004,0.0005,0.0006,0.0007)
w_real_chi_e = opt_real_e(G,R,e,n,gamma,k,0.2)
w = w_real_chi_e
K = length(w)
result_fg3_MV=c()
for(k in 1:K){
result_fg3_MV = cbind(result_fg3_MV,analys_OS10(w[[k]],test_data2$OS_10))
}
result_fg3_MG
result_fg3_MV
opt_real_MV_u = function(G,R,e,n,gamma,k,u){
## set model parameters
params <- list()
params$method = 2
params$NonConvex = 2
params$ResultFile = 'model.sol'
I = length(u)
w = as.list(rep(NA,I))
for(i in 1:I){
model = model_real_MV(G,R,e,n,gamma,k,u[i])
result <- gurobi(model, params)
w[[i]] = result$x[1:(n+1)]
}
return(w)
}
opt_real_MV_k = function(G,R,e,n,gamma,k,u){
## set model parameters
params <- list()
params$method = 2
params$NonConvex = 2
params$ResultFile = 'model.sol'
I = length(k)
w = as.list(rep(NA,I))
for(i in 1:I){
model = model_real_MV(G,R,e,n,gamma,k[i],u)
result <- gurobi(model, params)
w[[i]] = result$x[1:(n+1)]
}
return(w)
}
opt_real_MV_u = function(Sigma,R,e,n,gamma,k,u){
## set model parameters
params <- list()
params$method = 2
params$NonConvex = 2
params$ResultFile = 'model.sol'
I = length(u)
w = as.list(rep(NA,I))
for(i in 1:I){
model = model_real_MV(Sigma,R,e,n,gamma,k,u[i])
result <- gurobi(model, params)
w[[i]] = result$x[1:(n+1)]
}
return(w)
}
opt_real_MV_k = function(Sigma,R,e,n,gamma,k,u){
## set model parameters
params <- list()
params$method = 2
params$NonConvex = 2
params$ResultFile = 'model.sol'
I = length(k)
w = as.list(rep(NA,I))
for(i in 1:I){
model = model_real_MV(Sigma,R,e,n,gamma,k[i],u)
result <- gurobi(model, params)
w[[i]] = result$x[1:(n+1)]
}
return(w)
}
opt_real_MV_e = function(Sigma,R,e,n,gamma,k,u){
## set model parameters
params <- list()
params$method = 2
params$NonConvex = 2
params$ResultFile = 'model.sol'
I = length(e)
w = as.list(rep(NA,I))
for(i in 1:I){
model = model_real_MV(Sigma,R,e[i],n,gamma,k,u)
result <- gurobi(model, params)
w[[i]] = result$x[1:(n+1)]
}
return(w)
}
k = 0.001 #unit sell&buy transaction cost
e = c(0.0004,0.0005,0.0006,0.0007)
w_real_chi_e = opt_real_e(Sigma,R,e,n,gamma,k,0.2)
w = w_real_chi_e
K = length(w)
result_fg3_MV=c()
for(k in 1:K){
result_fg3_MV = cbind(result_fg3_MV,analys_OS10(w[[k]],test_data2$OS_10))
}
result_fg3_MV
k = 0.001 #unit sell&buy transaction cost
w_real_chi_e = opt_real_e(Sigma,R,e,n,gamma,k,0.2)
w = w_real_chi_e
K = length(w)
result_fg3_MV=c()
for(k in 1:K){
result_fg3_MV = cbind(result_fg3_MV,analys_OS10(w[[k]],test_data2$OS_10))
}
result_fg3_MV
k = c(0.0008,0.0009,0.001,0.0011)
w_real_chi_k = opt_real_k(Sigma,R,0.0006,n,gamma,k,0.2)
w = w_real_chi_k
K = length(w)
result_fg4_MV=c()
for(k in 1:K){
result_fg4_MV = cbind(result_fg4_MV,analys_OS10(w[[k]],test_data2$OS_10))
}
result_fg4_MV
result_fg4_MG
write.csv(result_fg3_MV,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg3_MV.csv", row.names = FALSE)
write.csv(result_fg3_MV,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg3_MV.csv", row.names = FALSE)
w_sim_Chi = opt_simple(Sigma,r,e,n)
w = w_sim_Chi
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS5(w[[k]],test_data2$OS_5))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table5_MV.csv", row.names = FALSE)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table6_MV.csv", row.names = FALSE)
write.csv(result_fg3_MV,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg3_MV.csv", row.names = FALSE)
write.csv(result_fg4_MV,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg4_MV.csv", row.names = FALSE)
write.csv(result_fg4,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg4_MG.csv", row.names = FALSE)
write.csv(result_fg4_MG,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg4_MG.csv", row.names = FALSE)
k = 0.001 #unit sell&buy transaction cost
u = c(1,0.2,0.3,0.4,0.5,0.6) #unpper bound for weights
w_real_chi_u = opt_real_u(Sigma,R,0.0006,n,gamma,k,u)
w = w_real_chi_u
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table8_MV.csv", row.names = FALSE)
analys_OS10 = function(w,R){
N = length(w)
## diversification
ZN = length(which(w != 0))
HI = sum(w %*% w)
## return of portfolio
Rp = c()
for(i in 1:10){
Rp[i] = 0
for(j in 1:N){
Rp[i] = R[[j]][i]*w[j]+Rp[i]
}
}
## mean, sd, cvar
mu = mean(Rp)
sd = sd(Rp)
cvar = abs(sum(sort(Rp)[c(1,2)])/(0.8*10))
## reward-to risk
R_sd = mu/sd
R_cvar = mu/cvar
FT_11 = sum(max(0,Rp)*0.1)/sum(abs(min(0,Rp))*0.1)
FT_13 = sum(max(0,Rp)*0.1)/(sum(abs(min(0,Rp))^3*0.1))^(1/3)
result = c(mu,sd,cvar,R_sd,R_cvar,FT_11,FT_13,ZN,HI)
return(result)
}
readInsample = function(index_return,index_div,country){
setwd(paste('C:/Users/User/Desktop/waterloo/actsc 970/final project/Data/',toString(country),sep=''))
N=length(index_return)
## read for returns
data_return = as.list(rep(NA,N))
for (i in 1:N) {
tdata = read.csv(paste(toString(index_return[i]),'.csv',sep=''))[,c(1,6)]
ti = as.Date(tdata[,1])
tdata = xts(tdata[,2],order.by = ti)
tdata = as.numeric(tdata)
for (j in 1:length(tdata)){ #deal with NA: take the same value as last period
if(is.na(tdata[j])){
tdata[j] = tdata[j-1]
}
}
for(k in length(tdata):2){
tdata[k] = tdata[k]/tdata[k-1]-1
}
tdata = xts(tdata[-1],order.by = ti[-1])
#    data_return[[i]] = tdata
data_return[[i]] = tail(tdata,137)
}
## read for dividents
data_div = as.list(rep(NA,N))
for (i in 1:N) {
if (is.na(index_div[i])){
data_div[[i]] = 0
}else{
data_div[[i]] = read.csv(paste(toString(index_div[i]),'_dividend_train.csv',sep=''))[,2]
}
}
data = list('return' = data_return,'div' = data_div)
return(data)
}
ind_amer_return = c('AAPL','AEP','APO','BA','BIDU','CBSH','DUK','EL','F','FDX','GS','HD','JNJ','JPM','KO','LFC','MCD',
'MDLZ','MSFT','NKE','PG','PTR','RIO','SNP','WMT','XOM','ZNH','riskfreerate')
ind_amer_div = c(NA,'AEP','APO','BA',NA,'CBSH','DUK','EL',NA,'FDX','GS','HD','JNJ','JPM','KO','LFC','MCD',
'MDLZ','MSFT','NKE','PG','PTR','RIO','SNP','WMT','XOM',NA,NA)
ind_amer_divt = c(rep(NA,20),'PG',rep(NA,7))
country1 = 'American'
Amer = OptimizeInfo(ind_amer_return,ind_amer_div,country1)
n = Amer$n
G = Amer$G
r = Amer$r_bar
R = Amer$R_bar
e = c(0.0007,0.0008,0.0009,0.001) #vector of required return
k = 0.001 #unit sell&buy transaction cost
gamma = 0.005 #bond for total transaction cost
u = c(1,0.2,0.3,0.4,0.5,0.6) #unpper bound for weights
w_sim_Amer = opt_simple(G,r,e,n)
w_sim_Chi = opt_simple(Sigma,r,e,n)
n = Amer$n
G = Amer$G
r = Amer$r_bar
R = Amer$R_bar
Sigma = Amer$Sigma
w_sim_Amer = opt_simple(G,r,e,n)
w = w_sim_Chi
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS5(w[[k]],test_data2$OS_5))
}
Sigma = Amer$Sigma
w_sim_Chi = opt_simple(Sigma,r,e,n)
w = w_sim_Chi
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS5(w[[k]],test_data2$OS_5))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table3_MV.csv", row.names = FALSE)
w = w_sim_Chi
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS5(w[[k]],test_data1$OS_5))
}
n = Amer$n
G = Amer$G
r = Amer$r_bar
R = Amer$R_bar
Sigma = Amer$Sigma
w_sim_Chi = opt_simple(Sigma,r,e,n)
w = w_sim_Chi
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS5(w[[k]],test_data1$OS_5))
}
test_data1 = readOutofSample(ind_amer_return,ind_amer_divt,country1)
test_data1 = readOutofSample(ind_amer_return,ind_amer_divt,country1)
readOutofSample = function(index_return,index_div,country){
setwd(paste('C:/Users/User/Desktop/waterloo/actsc 970/final project/Test/',toString(country),sep=''))
N=length(index_return)
## read for div
div = as.list(rep(NA,N))
for (i in 1:N) {
if (is.na(index_div[i])){
div[[i]] = 0
}else{
div[[i]] = read.csv(paste(toString(index_div[i]),'_dividend_test.csv',sep=''))[,2]
}
}
## read for returns
OS_5 = as.list(rep(NA,N))
OS_10 = as.list(rep(NA,N))
for (i in 1:N) {
tdata = read.csv(paste(toString(index_return[i]),'.csv',sep=''))[,c(1,6)]
ti = as.Date(tdata[,1])
tdata = xts(tdata[,2],order.by = ti)
tdata = as.numeric(tdata)
for(k in length(tdata):2){
tdata[k] = tdata[k]/tdata[k-1]-1
}
tdata = xts(tdata[-1],order.by = ti[-1])
OS_10[[i]] = tdata[1:10] + sum(div[[i]])/length(tdata)
OS_5[[i]] = tdata[1:5] + sum(div[[i]])/length(tdata)
}
mylist = list('OS_5' = OS_5, 'OS_10'=OS_10)
return(mylist)
}
test_data1 = readOutofSample(ind_amer_return,ind_amer_divt,country1)
w = w_sim_Chi
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS5(w[[k]],test_data1$OS_5))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table3_MV.csv", row.names = FALSE)
w_sim_Chi = opt_simple(G,r,e,n)
w = w_sim_Chi
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS5(w[[k]],test_data1$OS_5))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table3.csv", row.names = FALSE)
w_real_chi_u = opt_real_u(Sigma,R,0.0006,n,gamma,0.001,u)
w = w_real_chi_u
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table7_MV.csv", row.names = FALSE)
w_real_chi_u = opt_real_u(G,R,0.0006,n,gamma,0.001,u)
w = w_real_chi_u
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table7.csv", row.names = FALSE)
w = w_sim_Chi
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS10(w[[k]],test_data1$OS_10))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table4.csv", row.names = FALSE)
w_sim_Chi = opt_simple(Sigma,r,e,n)
w = w_sim_Chi
K = length(w)
result=c()
for(k in 1:K){
result = cbind(result,analys_OS10(w[[k]],test_data1$OS_10))
}
write.csv(result,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/table4_MV.csv", row.names = FALSE)
e = c(0.0004,0.0005,0.0006,0.0007)
w_real_chi_e = opt_real_e(Sigma,R,e,n,gamma,0.001,1)
w = w_real_chi_e
K = length(w)
result_fg3_MV=c()
for(k in 1:K){
result_fg3_MV = cbind(result_fg3_MV,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result_fg3_MV,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg1_MV.csv", row.names = FALSE)
w_real_chi_e = opt_real_e(G,R,e,n,gamma,0.001,1)
w = w_real_chi_e
K = length(w)
result_fg3_MG=c()
for(k in 1:K){
result_fg3_MG = cbind(result_fg3_MG,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result_fg3,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg1_MG.csv", row.names = FALSE)
k = c(0.0008,0.0009,0.001,0.0011)
w_real_chi_k = opt_real_k(Sigma,R,0.0006,n,gamma,k,1)
k = c(0.0008,0.0009,0.001,0.0011)
w_real_chi_k = opt_real_k(Sigma,R,0.0006,n,gamma,k,1)
w = w_real_chi_k
K = length(w)
result_fg4_MV=c()
for(k in 1:K){
result_fg4_MV = cbind(result_fg4_MV,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result_fg4_MV,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg2_MV.csv", row.names = FALSE)
w_real_chi_k = opt_real_k(G,R,0.0006,n,gamma,k,1)
k = c(0.0008,0.0009,0.001,0.0011)
w_real_chi_k = opt_real_k(G,R,0.0006,n,gamma,k,1)
w = w_real_chi_k
K = length(w)
result_fg4_MG=c()
for(k in 1:K){
result_fg4_MG = cbind(result_fg4_MG,analys_OS10(w[[k]],test_data2$OS_10))
}
write.csv(result_fg4_MG,"C:/Users/User/Desktop/waterloo/actsc 970/final project/result/fg2_MG.csv", row.names = FALSE)
